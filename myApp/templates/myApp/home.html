{% extends 'myApp/base.html' %}
{% load static %}

{% block title %}Home - Tulia{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#0B0E14] text-white" style="font-family: 'Inter', 'Manrope', sans-serif;">
  <!-- Variant A: Dashboard-first -->
  {% if profile.ab_variant == 'A' %}
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Hero: Resume Lesson -->
    {% if level_1_modules %}
    <div class="mb-8">
      <div class="bg-gradient-to-r from-violet-500/10 via-fuchsia-500/10 to-cyan-400/10 border border-white/10 rounded-2xl p-6 backdrop-blur-sm">
        <h2 class="text-2xl font-bold mb-4">Resume Lesson</h2>
        <a href="{% url 'lesson_runner' level_1_modules.0.lessons.first.id %}" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-violet-500 to-fuchsia-500 rounded-xl font-semibold hover:from-violet-600 hover:to-fuchsia-600 transition-all duration-200">
          Continue Module {{ level_1_modules.0.name|first }} ‚Üí
        </a>
      </div>
    </div>
    {% endif %}

    <!-- Module Cards A-D -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      {% for module in level_1_modules|slice:":4" %}
      <div class="bg-white/5 border border-white/10 rounded-2xl p-5 hover:bg-white/7.5 transition-all duration-200">
        <div class="text-sm font-semibold text-violet-300 mb-2">Module {{ module.name|first }}</div>
        <h3 class="text-lg font-bold mb-2">{{ module.name }}</h3>
        <p class="text-sm text-white/60 mb-4">{{ module.description|truncatewords:15 }}</p>
        <div class="text-xs text-white/40 mb-2">2 outcomes</div>
        {% if module.lessons.first %}
        <a href="{% url 'lesson_runner' module.lessons.first.id %}" class="text-sm font-semibold text-violet-400 hover:text-violet-300">
          Start ‚Üí
        </a>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <!-- Daily Quest -->
    {% if user_quests %}
    <div class="mb-8">
      <div class="bg-white/5 border border-white/10 rounded-2xl p-4 flex items-center justify-between">
        <div>
          <div class="text-sm font-semibold text-white/80 mb-1">Daily Quest</div>
          <div class="text-xs text-white/60">{{ user_quests.0.quest.description }}</div>
        </div>
        <div class="text-xs px-3 py-1 rounded-full bg-violet-500/20 text-violet-300">Active</div>
      </div>
    </div>
    {% endif %}

    <!-- District-1 Teaser (Locked) -->
    {% if level_1 and districts %}
    <div class="mb-8">
      <div class="bg-white/5 border border-white/10 rounded-2xl p-6 {% if not district_1_unlocked %}opacity-60{% endif %}">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold">District 1: {{ level_1.district_name }}</h3>
          {% if district_1_unlocked %}
          <span class="text-xs px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-300">Unlocked</span>
          {% else %}
          <span class="text-xs px-3 py-1 rounded-full bg-white/10 text-white/60">Locked</span>
          {% endif %}
        </div>
        <p class="text-sm text-white/60 mb-4">{{ level_1.district_description|truncatewords:20 }}</p>
        {% if district_1_unlocked %}
        <a href="{% url 'district_detail' level_1.id %}" class="text-sm font-semibold text-violet-400 hover:text-violet-300">
          Explore District ‚Üí
        </a>
        {% else %}
        <div class="text-xs text-white/40">Complete Level-1 milestone to unlock</div>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Variant B: Map-first -->
  {% else %}
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Hero: 2D District-1 City Tile -->
    {% if level_1 and districts %}
    <div class="mb-8">
      <div class="bg-gradient-to-r from-violet-500/10 via-fuchsia-500/10 to-cyan-400/10 border border-white/10 rounded-2xl p-8 backdrop-blur-sm {% if not district_1_unlocked %}opacity-60{% endif %}">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-3xl font-bold mb-2">District 1: {{ level_1.district_name }}</h2>
            <p class="text-white/60">{{ level_1.district_description }}</p>
          </div>
          {% if district_1_unlocked %}
          <span class="text-sm px-4 py-2 rounded-full bg-emerald-500/20 text-emerald-300 font-semibold">Unlocked</span>
          {% else %}
          <span class="text-sm px-4 py-2 rounded-full bg-white/10 text-white/60 font-semibold">Locked</span>
          {% endif %}
        </div>
        
        <!-- 3 Venues (Amphitheater, Forum, Market) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {% for district in districts|slice:":3" %}
          <div class="bg-white/5 border border-white/10 rounded-xl p-4 hover:bg-white/7.5 transition-all duration-200">
            <div class="text-lg mb-2">
              {% if 'Amphitheater' in district.name %}üèõÔ∏è
              {% elif 'Forum' in district.name %}üèõÔ∏è
              {% elif 'Market' in district.name %}üè™
              {% else %}üìç{% endif %}
            </div>
            <h4 class="font-semibold mb-2">{{ district.name }}</h4>
            <p class="text-xs text-white/60 mb-3">{{ district.description|truncatewords:10 }}</p>
            {% if district_1_unlocked %}
            <div class="text-xs text-white/40 mb-2">Entry: {{ district.ticket_cost_per_venue }} ticket{{ district.ticket_cost_per_venue|pluralize }}</div>
            <a href="{% url 'district_venue' district.id %}" class="text-xs font-semibold text-violet-400 hover:text-violet-300">
              Enter ‚Üí
            </a>
            {% else %}
            <div class="text-xs text-white/40">Complete milestone to unlock</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Bottom Rail: Lesson Track (A-D chips) -->
    <div class="fixed bottom-0 left-0 right-0 bg-[#0B0E14]/95 backdrop-blur-xl border-t border-white/10 z-40">
      <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="flex items-center justify-center gap-2">
          <span class="text-xs text-white/60 mr-2">Lesson Track:</span>
          {% for module in level_1_modules|slice:":4" %}
          <a href="{% url 'lesson_runner' module.lessons.first.id %}" class="px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 text-sm font-semibold transition-all duration-200">
            {{ module.name|first }}
          </a>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="pb-20"></div>
  </div>
  {% endif %}

  <!-- Stats Bar -->
  <div class="fixed top-16 right-4 z-30 flex items-center gap-3">
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl px-4 py-2 flex items-center gap-2">
      <span class="text-yellow-400">‚≠ê</span>
      <span class="text-sm font-semibold">{{ profile.total_xp|default:0 }}</span>
    </div>
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl px-4 py-2 flex items-center gap-2">
      <span class="text-amber-400">ü™ô</span>
      <span class="text-sm font-semibold">{{ profile.coins|default:0 }}</span>
    </div>
    {% if profile.tickets > 0 %}
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl px-4 py-2 flex items-center gap-2">
      <span class="text-violet-400">üé´</span>
      <span class="text-sm font-semibold">{{ profile.tickets }}</span>
    </div>
    {% endif %}
    {% if profile.current_streak > 0 %}
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl px-4 py-2 flex items-center gap-2">
      <span class="text-orange-400">üî•</span>
      <span class="text-sm font-semibold">{{ profile.current_streak }}</span>
    </div>
    {% endif %}
  </div>
</div>

<style>
  /* Quiet luxury aesthetic */
  body {
    font-family: 'Inter', 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
    line-height: 1.6;
    letter-spacing: -0.01em;
  }
  
  /* Fast and gentle motion (200-250ms) */
  * {
    transition-duration: 200ms;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Subtle glass effects */
  .backdrop-blur-sm {
    backdrop-filter: blur(8px);
  }
  
  .backdrop-blur-xl {
    backdrop-filter: blur(16px);
  }
</style>
{% endblock %}
